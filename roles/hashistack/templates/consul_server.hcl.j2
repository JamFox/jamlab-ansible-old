tls {
  defaults {
    ca_file = "/etc/consul.d/consul-agent-ca.pem"
    cert_file = "/etc/consul.d/dc1-server-consul-{{ ansible_hostname[-1] }}.pem"
    key_file = "/etc/consul.d/dc1-server-consul-{{ ansible_hostname[-1] }}-key.pem"
    verify_incoming = true
    verify_outgoing = true
  }

  internal_rpc {
    verify_server_hostname = true
  }
}

auto_encrypt {
  allow_tls = true
}

server = true
bootstrap_expect = 3

client_addr = "0.0.0.0"

addresses {
  grpc = "127.0.0.1"
}

ui_config {
  enabled = true
}
