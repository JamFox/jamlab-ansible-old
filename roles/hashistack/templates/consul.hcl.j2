# Managed by jamlab-ansible
datacenter = "dc1"
data_dir = "/opt/consul"
encrypt = "{{ consul_gossip_key }}"

{% if hashistack is defined %}
    {%- if hashistack == 'server' %}
        {%- include 'consul_server.hcl.j2' %}
    {%- elif hashistack == 'client' %}
        {%- include 'consul_client.hcl.j2' %}
    {% endif %}
{% endif %}


connect {
  enabled = true
}

bind_addr = "{{ ansible_eth0.ipv4.address }}"
client_addr = "0.0.0.0"

ports {
  http = 8500
  https = 8501
  grpc = 8502
  dns = 8600
}

addresses {
  http = "127.0.0.1"
  grpc = "127.0.0.1"
}

retry_join = ["vb0.jamfox.dev", "vb1.jamfox.dev", "vb2.jamfox.dev"]

acl {
  enabled = true
  default_policy = "allow"
  enable_token_persistence = true
}

performance {
  raft_multiplier = 1
}

telemetry {
  prometheus_retention_time = "480h"
  disable_hostname          = true
}
