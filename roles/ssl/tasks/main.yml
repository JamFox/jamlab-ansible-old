# DDNS

- name: Install ddclient
  ansible.builtin.apt:
    name:
      - ddclient
    state: latest

- name: Configure ddclient
  ansible.builtin.template:
    src: ddclient.conf.j2
    dest: /etc/ddclient.conf
  register: r_ddclient_conf
  no_log: true

- name: Restart ddclient
  ansible.builtin.systemd:
    name: ddclient
    state: restarted
  when: r_ddclient_conf.changed

# CERTBOT

- name: Remove system default certbot
  ansible.builtin.apt:
    name:
      - certbot
    state: absent

- name: Check /snap/bin/certbot
  ansible.builtin.stat:
    path: /snap/bin/certbot
  register: r_certbot

- name: Install cerbot from snap
  ansible.builtin.shell: snap install --classic certbot; snap set certbot trust-plugin-with-root=ok; snap install certbot-dns-cloudflare
  when: not r_certbot.stat.exists

- name: Link certbot to /usr/bin
  ansible.builtin.file:
    src: /snap/bin/certbot
    dest: /usr/bin/certbot
    state: link
